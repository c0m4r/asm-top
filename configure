#!/bin/sh
# configure script for asm-top

# Default values
PREFIX="/usr/local"
BINDIR=""
MANDIR=""

# Help message
show_help() {
    cat << EOF
Usage: ./configure [OPTION]...

Configuration:
  -h, --help              display this help and exit

Installation directories:
  --prefix=PREFIX         install architecture-independent files in PREFIX
                          [/usr/local]
  --bindir=DIR            user executables [PREFIX/bin]
  --mandir=DIR            man documentation [PREFIX/share/man]

Example:
  ./configure --prefix=/usr
  ./configure --prefix=\$HOME/.local
EOF
    exit 0
}

# Parse command line arguments
while [ $# -gt 0 ]; do
    case "$1" in
        --prefix=*)
            PREFIX="${1#*=}"
            ;;
        --bindir=*)
            BINDIR="${1#*=}"
            ;;
        --mandir=*)
            MANDIR="${1#*=}"
            ;;
        -h|--help)
            show_help
            ;;
        *)
            echo "Unknown option: $1"
            echo "Try './configure --help' for more information."
            exit 1
            ;;
    esac
    shift
done

# Set default directories if not specified
if [ -z "$BINDIR" ]; then
    BINDIR="$PREFIX/bin"
fi

if [ -z "$MANDIR" ]; then
    MANDIR="$PREFIX/share/man"
fi

# Check for required tools
echo "Checking for required tools..."

if ! command -v nasm >/dev/null 2>&1; then
    echo "ERROR: nasm not found. Please install NASM assembler."
    exit 1
fi
echo "  nasm: found"

if ! command -v ld >/dev/null 2>&1; then
    echo "ERROR: ld not found. Please install GNU binutils."
    exit 1
fi
echo "  ld: found"

# Generate config.mk
echo "Generating config.mk..."
cat > config.mk << EOF
# Generated by configure script
# Do not edit manually - run ./configure to regenerate

PREFIX = $PREFIX
BINDIR = $BINDIR
MANDIR = $MANDIR
EOF

echo ""
echo "Configuration successful!"
echo ""
echo "  Installation prefix: $PREFIX"
echo "  Binary directory:    $BINDIR"
echo "  Manual directory:    $MANDIR"
echo ""
echo "You can now run 'make' to build asm-top"
echo "Then run 'make install' to install (may require sudo)"
